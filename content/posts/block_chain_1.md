---
title: "01｜什么是区块链？"
date: 2021-08-03T12:21:50+08:00
tags: ["区块链"]
categories: ["技术前沿"]
draft: false
---

本文记录了非技术专业出身人员对区块链技术整体认知的建立过程，该系列将分为区块链概述、比特币区块链的本质、数字货币与智能合约、底层技术、应用场景与发展发向五个部分。

此文为第一部分，理解什么是区块链。

# 01｜如何理解区块链？

## 一、官方释义

> ​	区块链（Blockchain）技术是利用**块链式数据结构**来验证和存储数据、利用**分布式节点共识算法**来生成和更新数据、利用**密码学的方式**保证数据传输和访问的安全性、利用由**自动化脚本代码组成的智能合约**来编程和操作数据的一种全新的分布式基础架构与计算范式。
>
> ——《中国区块链技术与应用白皮书》（2016）



> ​	区块链是一个**去中心化**的分布式数据库，该数据库由一串**使用密码学方法产生的数据区块**有序链接而成，区块中包含有一定时间内产生的无法被篡改的数据记录信息。
>
> ​	区块中包含数据记录、当前区块**根哈希（Hash）**、前一区块根哈希、时间戳以及其他信息。数据记录在存储过程中，通常组织为树形式，比如**默克尔树**，而区块根哈希实际就是数据记录树的根节点哈希，为根据数据记录树自下而上逐步通过SHA-256等**哈希算法计算得出**。时间戳为区块的生成时间。其他信息包括区块签名信息、随机值等信息，也可根据具体应用场景灵活定义。
>
> ——《区块链：从数字货币到信用社会》

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903111349762.png" alt="image-20210903111349762" style="zoom: 33%;" />

无论是国家发布的白皮书，还是区块链相关的书籍，在定义区块链时使用的都是专业术语，即使挨个查询了这些术语，我仍然没有底气说我理解了这个概念。

那抛开这些专业的材料和解释，有没有一种简单的方式来理解区块链呢？

## 二、漫画区块链

我们先来看看下面的漫画案例：

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903112654144.png" alt="image-20210903112654144" style="zoom: 50%;" />

假如某一天你因为肚子痛，跑到村里的医院去看病，忍着剧烈不适好不容易做完了一系列的检查，结果卫生所的医生告诉你这病他治不了，建议你转到市里的医院去看；

于是你吭哧吭哧的跑到了市里的三甲医院，想让医生基于村里卫生所的各项化验结果赶紧给个处方，然而市医院的医生开出，依旧是一堆要做的检查；

这样的现象非常普遍，同样的检查，去不同的医院需要重复做，即使病人带上了之前的化验结果，医生也还是要求重新跑一遍流程，既耽误患者时间，还浪费社会资源，为什么还要这么做呢？

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903113459519.png" alt="image-20210903113459519" style="zoom: 50%;" />

我们将每一家医院看做是一个数据库，病人的病例信息都会上传到自家的数据库中存档。问题在于，每家医院的数据库都是相互独立、互不通气的，这就导致患者转院时需要重复做检查，这么做一方面可以减少医生误诊的风险（比如不信任别的医院检查结果），另一方面也是出于医院的病例信息收集和存储的要求。

如果将所有医院的数据库打通，实现病例信息共享，并落实好检验责任人，这样就可以避免重复性检查的发生。

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903114332017.png" alt="image-20210903114332017" style="zoom:50%;" />

好，漫画到这里就结束了，但是有几个问题它没有解释清楚。比如区块到底是什么？区块与区块之间的链路是如何产生？通过什么样的机制让区块之间链起来的？

## 三、进一步深挖

#### Q1: 怎么理解「区块」？

按照字面意思，我们可以把「区块」想象成一个个的信封，用于存放本次获取到的数据 or 信息，每写入一次数据就会对应创建一个新的区块。

每个「区块」包含两个部分：

 * head部分

   记录当前区块相关的元数据，比如生成时间，上一个区块的hash值，以及当前区块的hash值等；

 * body部分

   记录当前区块存储的具体数据

<img src="https://raw.githubusercontent.com/taylor0931/pics-repo/master/img/image-20210903114818451.png" alt="image-20210903114818451" style="zoom: 67%;" />

#### Q2：区块与区块之间的链接机制

利用密码学里的一种「hash算法」实现区块与区块间的链接。目前比较通用的算法之一叫 **SHA256**。

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903115502162.png" alt="image-20210903115502162" style="zoom: 67%;" />

我们继续深入扩展，了解一下 hash 算法的具体原理

#### Q3：Hash 算法原理

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903120038208.png" alt="image-20210903120038208" style="zoom:67%;" />

上图的左边部分是区块的伪代码，去头去尾，我们重点看一下中间的几行hash值的计算代码。

很容易观察到 hash 值的计算仅涉及区块 head 里的数据，简单来讲，可以将 hash 值的计算改写成下方的公式：
$$
blockHash = SHA256 (block.header) = SHA256 (prevBlockHash +block.body+ Nonce)
$$
即，当前区块的 hash 值由 3 个参数决定：

- 上一个区块的hash值；

- 当前区块体的特征值；

- Nonce随机项

  *Ps. 之所以设置Nonce这个常量，涉及到中本聪设计比特币时的规则机制，因此Nonce值和difficlty（难度系数）将在第二部分数字货币里详细介绍，此处暂时跳过*

最终，得到一个256位的二进制数字，即hash值。

通过上述这样一种逻辑关系，让所有区块之间串起来了，这种逻辑傻姑娘的联动机制意味着，当某个区块内容变动时，会导致一系列的联动效应（蝴蝶效应）。因为当一个区块内存储的信息被更改后，其hash值一定会发生改变，进而引起上下游区块hash值的一连串变动。

然而hash值的计算十分耗时，链条越长，对算力的要求就越高。这就使得在实际操作过程中，某个区块的数据更改概率几乎为0，换句话说，存储在区块链中的数据天然无法被篡改，只能不断append（添加）数据。

#### 小结：区块链是某种特别 Niubility 的数据库

$$
区块链 = 某种特别 Niubility 的数据库
$$

简单来讲，区块链就是一种存储数据的数据库，但由于技术设计的原因，导致它与普通的关系型数据库有所不同。

**区块链 vs. 普通关系型数据库**

- 普通关系型数据库—— **read** **&** **write** **模式**

  其控制权掌握在所有者（admin）手里，掌握权力的人（admin）可以对其进行篡改而不被其他利益相关者所知

- 区块链—— **read** **&** **append** **only** **模式**

  由于hash的计算难度，导致区块内部数据的更改可能性几乎为零，所以区块链存储的数据都是**真实有效**的（**无法被篡改**），只能不断append（添加）数据记录；

  意味着：**在区块链里，围绕每一个对象的每一次的操作都会被记录（append），无论什么操作都能回溯到责任人**

#### Q4：各个区块串联起来后，全量数据又是如何存储和备份的？

我们接着深入

当各个医院内部数据、医院与医院之间的数据都通过区块链串联起来，理论上来说，每家医院都拥有了所有医院都全量数据，但全国人民都病例信息非常庞大，如果每家医院都购买服务器保存一份全量信息的副本，成本巨大，不仅不经济，也不现实。这就涉及到另一个专业术语——「分布式存储」。

分布式存储到方式很多，这里仅介绍最简单的一种，如下图所示。

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903140828946.png" alt="image-20210903140828946" style="zoom:50%;" />

图中的每一台机器都可视作某个网民联网后的 PC，这些 PC 都与一台总服务器相连接，这个总服务器我们可以理解为“上帝”，它负责与其他电脑联络。假设目前机器 N 有 100 个 T 的数据要存储，具体过程如下：

​		1）机器A向总服务器发送请求：“呼叫老大，我现在需要 100 个 T 的存储空间”；

​		2）服务器接到请求后，会与目前联网的所有PC联络：“总台呼叫，请各位汇报当前是否有空余存储空间？可用空间是多少？”

​		3）各个联网的PC进行回复，然后总服务器汇总，并将可存储的设备列表返回给机器 N；

​		4）机器 N 拿到总服务器返回的可存储列表之后，根据列表上的设备名单和存储空间将这100个T的数据进行切分，向具体设备分发需要存储的“数据块”，如下图所示。

​		5）为了数据的安全性、一致性和完整性，**每个数据块都需要进行备份**，一般都会选择其他设备来存储副本；

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903142051159.png" alt="image-20210903142051159" style="zoom:50%;" />

​		6）切分、存储和备份工作完成后，机器 N 需要将这 100 个 T 的元数据发送给总服务器进行存储；此时我们可以将总服务器视为一个索引服务器，负责存储种子元数据，通过它可以找到100T的全量数据。

​		例如之前下载电影时遇到的“BT种子”、“迅雷种子”等，就是这部电影的元数据，包含它的名称，大小，分为几个数据块，分别存在哪里，存储的顺序是什么；下载的时候，先把种子元数据下载好后，再依次按照各个设备的存储顺序下载，最后进行拼接，下载完成。

这种分布式存储真正实现了“你有我有全都有”的状态，医院想要这100T的数据的时候，通过索引服务器拉下来，再拼接就好了。

#### Q5：数据有任何的改动时，是如何确保分布式存储中数据的一致性的？

分布式存储和备份后，数据有任何改动，又是如何保证数据一致性的呢？

这里要介绍一个用来描述分布式系统一致性问题（Distributed Consensus）的案例——**「拜占庭将军问题」**

该案例是Leslie Lamport（2013 年的图灵奖得主）在论文中抽象出来的著名案例，本质上阐述的是通信过程中由于消息丢失，或是传输错误导致的**信息不一致**问题。

对于这一问题，网上文章描述的相对复杂，涉及的节点也较多，为了清晰理解，我将将军和副将的阵容最简化，精简为三个人的模型，如下图所示。

假设现在需要攻打临近的一个国家，将军A在大本营坐镇，发号施令。前方由他的两个副将带领军队进行攻击。将军和副官3人里都有可能出现叛徒，只要在信息传输上保证三人达成一致共识——进攻邻国，这场战争就能取得胜利。

假设副官 B 是叛徒，那么将军下达“进攻”命令时，副官 B 会向副官 C 谎报收到的命令，这个时候 C 会因为自己收到消息与副官 B 的不一致而一脸懵逼。

假设将军 A 是叛徒，那他在向两位副官下发命令的时候，就会发送两个不一样的版本，副官 B 和副官 C 在相互核对时，发现拿到的情报不一致，两脸懵逼。

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903142936287.png" alt="image-20210903142936287" style="zoom: 50%;" />

那么该如何保证大家达成一致共识呢？

* 方案一：口头信息传输

  在原始时代，交通条件和技术条件都很落后，基本是「出行靠走，通讯靠吼」，因此收信方在拿到上一节点传输的消息之后，两两对比，根据少数服从多数的原则，遵从多数人收到的命令即可；

  但这个方案有弊端，当叛徒数量>=1/3时，这个方法会失效。

- 方案二：书面信息传输（盖章）

  这里先介绍一下加密传输的两种方式：

  ​	1）对称加密：指的是两个人事先约定好，123=ABC；只要拿到密码本，就可以破解机密信息（类似一战二战时的信息加密方式）

  ​	2）非对称加密：即每个人有两把钥匙，一把公钥，一把私钥，公钥广而告之、大家都有，私钥只有自己有；

  本方案里用到的加密方式是非对称的形式。将军 A 在传输“进攻”消息时，通过自己的私钥进行加密；副将 B 和 C 在收到信函之后需要利用将军 A 的公钥打开，且只要能成功打开，即验证了将军 A 的真实身份。

  副将 B 和 C 在打开成功后，还需要盖章批阅，类似“我同意进攻”的形式继续下发消息，比如与C之间通信；如果B是叛徒，由于一份文件上需要包含所有经手人的章，他是无法在盖上将军 A 印章的文书上伪造“撤退”消息的，因而保证了信息传输的一致性；

  假设将军 A 是叛徒，他用私钥加密信息，向副将 B 传输“进攻”消息，向副将 C 传输“撤退”消息；由于要打开信函一定会用到将军A的真实公钥，所以B和C在确认将军真实身份的情况下，发现信息不一致，立刻就能识别出将军的叛徒身份。此时副将 B 和 C 将自行判断是进攻还是撤退，两者达成一致后实施，将军 A 的意见将被忽略

<img src="../../../../../Library/Application%20Support/typora-user-images/image-20210903144531318.png" alt="image-20210903144531318" style="zoom:50%;" />

这就是中本聪在设计比特币和区块链时的思路。

#### 小结：hash链 + 分布式 = 区块链

通过第二阶段的深挖，我们对区块链技术有了更深刻的理解。

个人认为，从技术角度，区块链可以表达为上述等式，即：
$$
区块链 = hash link + 分布式存储（共识问题）
$$
这就是最原始的区块链版本。

在这样的链条里，每个节点都是平等的，都能参与通信，也就是所谓的公有链。但也正因为如此，当一个决策发布时，需要得到网络中超过51%的节点同意（少数服从多数），才能得以通过，因此效率十分低下。当然这中间还有 hash 值计算量大的原因，这一点会在下一节挖矿部分深挖。

另外，所有节点的权重都一样，这对于一项决议的通过是不科学的，因为精英阶层的意见可能比平民阶层更重要。基于此，发展出了另外一种类型的区块链——联盟链。

## 四、区块链的类型

#### 4.1 公有链（原始版本）

公有链即上方介绍的原始版本，具有以下特征：

 * 去中心化
   	* 任何人都可以读取
   	* 任何人都可以通信
   	* 任何人都可以参与

简单来讲，无论是个人、企业还是联盟在链条里都平等（权重一致），都能收到和发送相关信息

#### 4.2 联盟链（consortium blockchains)

属于**许可链**（permission blockchains)中的一种，可以理解为**行业范围内的区块链**；
$$
邀请机制+角色权限（权重）=联盟链
$$
特征：

 * 只有被验证的成员才能加入链条（**邀请机制**，我国的数字货币使用的是这一类型的区块链），不同节点有不同的角色和分工，对应不同的权限

 * **部分去中心化**

   从系统外部来看，整个联盟就是一个中心；

   但是从系统内部看，各个节点之间还是去中心化的，因为即使不同节点权重不同，在现实情况中也很难达到51%以上的情况

#### 4.3 私有链

属于**许可链**（permission blockchains)中的一种，可以理解为**小范围系统内部的区块链**，比如企业内部的跨部门授权区块链；

本质上联盟链也是私有链的一种；因为公有链可以看做是地球上的私有链，因为只有地球人的电脑系统才可以接入；

私有链与联盟链在效率和速度上非常有优势；且可以不用设置token机制（公有链需要token机制作为激励机制，比如比特币）



#### *参考资料*

*part 1. **政府相关文件***

*1.中国区块链技术和产业发展论坛，《中国区块链技术与应用发展白皮书》，2016-10-18.*

*2.任仲文编，《区块链领导干部读本》，人民日报出版社，2018.* 

*part 2. **参考书籍***

*1.[美] William Mougayar，《商业区块链：开启加密经济时代》，中信出版社，2016.*

*2.韦康博，《解读区块链：重新定义未来经济》，人民邮电出版社，2017.* 

*3.吴为，《区块链实战》，清华大学出版社，2017.* 

*4.[美] 阿尔文德·纳拉亚南等，《区块链：技术驱动金融》，中信出版社，2016.*

*5.张健，《区块链：定义未来金融与经济格局》，机械工业出版社，2016.*

*6.长铗、韩锋等，《区块链，从数字货币到信用社会》，2016.*

*7.徐明星、刘勇、段新星、郭大治，《区块链，重塑经济与世界》，中信出版社，2016.*

*part 3. **网络课程***

*1.朱嘉伟，「从0到1，全面学透区块链」，MOOC.*

*2.Tiny，「区块链技术核心概念与原理讲解」，慕课网.*

*part 4. **社区论坛***

*1.慕课网—「手记」栏目--「区块链」专栏，[ https://www.imooc.com/article/blockchain](https://www.imooc.com/article/blockchain)*

*2.知乎相关专栏&问答， https://www.zhihu.com/*

*3.相关blog*

*4.公众号相关文章*